<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, target-densitydpi=device-dpi" />
        <link rel="stylesheet" type="text/css" href="css/index.css" />
        <link rel="stylesheet" type="text/css" href="css/menu.css" />
        <link rel="stylesheet" type="text/css" href="res/jquerymobile/jquery.mobile-1.4.5.min.css" />
        <link rel="stylesheet" type="text/css" href="res/jquerymobile/jquery.mobile.theme-1.4.5.min.css" />

        <script type="text/javascript" src="js/jquery.js"></script>
        <script type="text/javascript" src="res/jquerymobile/jquery.mobile-1.4.5.min.js"></script>
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/urlHelper.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript" src="js/main-config.js"></script>
        <script type="text/javascript" src="js/menu.js"></script>
        <script type="text/javascript" src="js/localhelper.js"></script>
        <script type="text/javascript" src="js/trajet.js"></script>

        <title>LAP - La conduite</title>
    </head>
    <body>
        <div id="menu">
            <h3>Menu</h3>
            <ul>
                <li class="active"><a href="nouveau_trajet.html" class="contentLink" rel="external">Nouveau </a></li>
                <li><a href="mesTrajets.html" class="contentLink" rel="external">Mes Trajets </a></li>
                <li><a href="navigation.html" class="contentLink" rel="external">Navigation </a></li>
                <li><a href="monProfil.html" class="contentLink" rel="external">Profil </a></li>
            </ul>
        </div>

        <div data-role="page" id="page-testTrajet">
            <div data-role="header" data-theme="a">
                <a href="#"class="showMenu">Menu</a>
                <h1>Mes Trajets</h1>
            </div>

            <div data-role="content">
                <h2>Test trajets</h2>
                <ul data-role="listview" data-inset="true">
                    <li><a href="#page-listeTrajets" data-icon="custom">Mes Trajets</a></li>
                </ul>
            </div>

            <div data-role="footer" data-position="fixed" data-tap-toggle="false">

            </div>

            <script type="text/javascript">
                var trajet1 = new trajet("manuel");
                trajet1.setTitre("Trajet 1");
                trajet1.setDepart(20,30);
                trajet1.setArrivee(50,60);
                trajet1.setDistanceTotale(17);
                trajet1.setTempsTotal(25);
                trajet1.setVitesseMoyenne(75);
                trajet1.setMeteo("Ensoleillé");
                trajet1.setTypeRoute("Campagne");
                trajet1.setPeriode("Jour");

                var trajet2 = new trajet("manuel");
                trajet2.setTitre("Trajet 2");
                trajet2.setDepart(20,30);
                trajet2.setArrivee(50,60);
                trajet2.setDistanceTotale(40);
                trajet2.setTempsTotal(60);
                trajet2.setVitesseMoyenne(82);
                trajet2.setMeteo("Ensoleillé");
                trajet2.setTypeRoute("Campagne");
                trajet2.setPeriode("Jour");

                trajet1.save();
                trajet2.save();
            </script>
        </div>

        <div data-role="page" id="page-listeTrajets" >
            <div data-role="header" data-theme="a">
                <a href="#"class="showMenu">Menu</a>
                <h1>Trajets Parcourus</h1>
            </div>

            <div data-role="content">
                <h2>Mes trajets</h2>
                <ul data-role="listview" data-inset="true" id="liste_effectuees"></ul>

                <form>
                    <label for="slider-distance">Distance totale parcourue :</label>
                    <p name="text-distance" id="text-distance"></p>
                    <input type="range" name="slider-distance" id="slider-distance" data-highlight="true" min="0" max="100" value="50">
                </form>
            </div>

            <script>
                var a = Locstor.list('trajet_');
                $.each(a, function (i) {
                    var monTrajet = Locstor.get(a[i]);
                    var liste_trajets = $('#liste_effectuees');
                    liste_trajets.append('<li data-name="'+a[i]+'"><a href="#page-detailsTrajet" data-icon="custom">'+monTrajet.titre+'</a></li>')

                });

                $('ul').children('li').on('click', function () {
                    Locstor.set('courant_trajet', $(this).attr('data-name'));
                });

                $(document).on('pagebeforeshow', '#page-listeTrajets', function (e, data) {
                    var monProfil = Locstor.get('monProfil');
                    var valeur = 0;

                    var a = Locstor.list('trajet_');
                    $.each(a, function (i) {
                        var trajet = Locstor.get(a[i]);
                        valeur = valeur + trajet.distanceTotal;
                    });


                    $('#slider-distance').val(valeur);
                    $("#slider-distance").attr("max", monProfil.distanceTotale);
                    $('#text-distance').html(valeur+" km sur "+monProfil.distanceTotale+" km ("+valeur*100/monProfil.distanceTotale+" %)");
                    $('#slider-distance').slider("refresh");
                    
                    $("input").remove();
                    $(".ui-slider-handle").remove();
                    $('.ui-slider-track').css('margin','0 0 0 0').css('pointer-events','none');
                });
            </script>
        </div>

        <div data-role="page" id="page-detailsTrajet" >
            <div data-role="header" data-theme="a">
                <a href="#"class="showMenu">Menu</a>
                <h1>Détails de mon trajet</h1>
            </div>

            <div data-role="content">
                <h2 id="text-titre"></h2>

                <table>
                    <tr>
                        <td>Départ</td>
                        <td id="text-depart"></td>
                    </tr>

                    <tr>
                       <td>Arrivée</td>
                        <td id="text-arrivee"></td>
                    </tr>

                    <tr>
                        <td>Distance</td>
                        <td id="text-km"></td>
                    </tr>

                    <tr>
                        <td>Temps</td>
                        <td id="text-temps"></td>
                    </tr>

                    <tr>
                        <td>Vitesse moyenne</td>
                        <td id="text-vitesse"></td>
                    </tr>

                    <tr>
                        <td>Météo</td>
                        <td id="text-meteo"></td>
                    </tr>

                    <tr>
                        <td>Type de route</td>
                        <td id="text-route"></td>
                    </tr>

                    <tr>
                        <td>Période</td>
                        <td id="text-periode"></td>
                    </tr>
                </table>
            </div>

            <script type="text/javascript">
                $(document).on('pagebeforeshow', '#page-detailsTrajet', function (e, data) {                    
                    if (Locstor.contains(Locstor.get('courant_trajet'))) {
                        var monTrajet = Locstor.get(Locstor.get('courant_trajet'));
                        $('#text-titre').html(monTrajet.titre);
                        $('#text-depart').html("Lattitude : "+monTrajet.depart.lat + " Longitude : " + monTrajet.depart.lng);
                        $('#text-arrivee').html("Lattitude : "+monTrajet.arrivee.lat + " Longitude : " + monTrajet.arrivee.lng);
                        $('#text-km').html(monTrajet.distanceTotal+' km');
                        $('#text-temps').html(monTrajet.tempsTotal+' min');
                        $('#text-vitesse').html(monTrajet.vitesseMoyenne+' km/h');
                        $('#text-meteo').html(monTrajet.meteo);
                        $('#text-route').html(monTrajet.typeRoute);
                        $('#text-periode').html(monTrajet.periode);
                    } 
                    else {
                        alert("Clé inconnue : "+Locstor.get('courant_trajet'));
                    }                    
                });
            </script>
        </div>

        <script type="text/javascript">
            // pour initialiser l'app
            app.initialize();
        </script>
    </body>
</html>
